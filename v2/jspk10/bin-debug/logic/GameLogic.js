var __reflect=this&&this.__reflect||function(e,t,a){e.__class__=t,a?a.push(t):a=[t],e.__types__=e.__types__?a.concat(e.__types__):a},__extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)},game;!function(e){var t=function(t){function a(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.onAdded,e),e}return __extends(a,t),a.prototype.onAdded=function(t){e.GameGlobal.stage=this.stage,this.init()},Object.defineProperty(a,"instance",{get:function(){return this._instance||(this._instance=new a)},enumerable:!0,configurable:!0}),a.prototype.init=function(){e.LoopManager.init(e.GameGlobal.stage);var t=new egret.DisplayObjectContainer;this.addChild(t),e.LayerManager.init(t);var a=new eui.Component;a.skinName=MainViewSkin,this._animContainer=a.animContainer,e.SceneLogic.instance.init(a.sceneContainer),this.onResizeStage(),e.PopUpManager.init(e.GameGlobal.stage),e.PopUpManager.addPopUp(a,!1,!1);new e.TopView(a.topUI),new e.MiddleView(a.middleUI),new e.BottomView(a.bottomUI);e.ChartLogic.init(a.countContainer),e.SoundLogic.init(),e.DataEventDispatcher.addEventListener(e.GameEventType.TRY_GAME,this.onTryGame,this),e.DataEventDispatcher.addEventListener(e.GameEventType.AWARD_DATA,this.onNewResult,this),e.DataEventDispatcher.addEventListener(e.GameEventType.STATUS_CHANGE,this.statusChange,this),e.GameGlobal.status=e.Status.standby,e.DataManager.dispatchData()},a.prototype.onResizeStage=function(){var t=e.GameGlobal.stage.stageWidth,a=e.GameGlobal.stage.stageHeight;e.GameConst.STAGE_WIDTH=t,e.GameConst.STAGE_HEIGHT=a,e.LayerManager.resize(t,a),e.SceneLogic.instance.resize(t,a),e.DataEventDispatcher.dispatchEventWith(e.GameEventType.STAGE_RESIZE)},a.prototype.onNewResult=function(t){1==t.data.isNew&&e.SceneLogic.instance.setResult(t.data.numbers)},a.prototype.onTryGame=function(t){e.LoopManager.setTimeout(e.SceneLogic.instance.setResult,e.SceneLogic.instance,1e3*e.GameConst.SIMULATE_TIME,e.DataManager.getSimulateAwardData())},a.prototype.statusChange=function(t){var a=this,n=t.data;switch(n){case e.Status.start:break;case e.Status.free:e.DataManager.isSimulate||e.DataManager.GetDataContinuty();break;case e.Status.goAnimate:e.LoopManager.setTimeout(e.DataEventDispatcher.dispatchEventWith,this,e.GameConst.CAR_GO_DELAY_MS,e.GameEventType.START_GAME);break;case e.Status.over:if(!this.dragonbonesFactory){this._endAnimContainer=new egret.DisplayObjectContainer;var i=new egret.Bitmap(RES.getRes("endBg_png"));this._endAnimContainer.addChild(i),this.dragonbonesFactory=new dragonBones.EgretFactory,this.dragonbonesFactory.parseDragonBonesData(RES.getRes("end_ske_json")),this.dragonbonesFactory.parseTextureAtlasData(RES.getRes("end_tex_json"),RES.getRes("end_tex_png")),this._endAnim=this.dragonbonesFactory.buildArmatureDisplay("Armature","end"),this._endAnim.x=468,this._endAnim.y=300,this._endAnimContainer.addChild(this._endAnim),this._endAnim.armature.addEventListener(dragonBones.AnimationEvent.LOOP_COMPLETE,function(){e.LoopManager.setTimeout(function(){e.PopUpManager.removePopUp(a._endAnimContainer),e.GameGlobal.status=e.Status.rest},a,1e3)},this)}var o=e.SceneData.rank.slice(0,3),s=o[0],r=o[1],p=o[2];this.replaceSlot("zhong_1","zhong_"+s,"zhong_"+s),this.replaceSlot("zuo_1","zuo_"+r,"zuo_"+r),this.replaceSlot("zuo_11","zuo_"+p+"1","zuo_"+p),this.replaceSlot("jiangpaihao1","jiangpaihao"+s,"jiangpaihao"+s),this.replaceSlot("jiangpaihao11","jiangpaihao"+r+"1","jiangpaihao"+r),this.replaceSlot("jiangpaihao12","jiangpaihao"+p+"2","jiangpaihao"+p),this.replaceSlot("shuzi_1","shuzi_"+s,"shuzi_"+s),this.replaceSlot("shuzi_11","shuzi_"+r+"1","shuzi_"+r),this.replaceSlot("shuzi_12","shuzi_"+p+"2","shuzi_"+p),e.PopUpManager.addPopUp(this._endAnimContainer,!1,!1,this._animContainer);var h=this._endAnim.animation.gotoAndPlay("newAnimation");h.playTimes=1;break;case e.Status.rest:e.LoopManager.setTimeout(function(){e.GameGlobal.status=e.Status.standby,e.DataManager.isSimulate=!1},this,50)}},a.prototype.replaceSlot=function(e,t,a){var n=this._endAnim.armature.getBone(e);this.dragonbonesFactory.replaceSlotDisplay("end","Armature",t,a,n.slot)},a}(egret.Sprite);e.GameLogic=t,__reflect(t.prototype,"game.GameLogic")}(game||(game={}));