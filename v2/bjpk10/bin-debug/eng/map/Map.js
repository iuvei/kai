var __reflect=this&&this.__reflect||function(t,i,e){t.__class__=i,e?e.push(i):e=[i],t.__types__=t.__types__?e.concat(t.__types__):e},__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},game;!function(t){var i=egret.Bitmap,e=egret.Sprite,s=function(s){function a(){var t=s.call(this)||this;return t._visibleRect=new egret.Rectangle((-1),(-1),0,0),t._currentX=0,t._currentY=0,t._roadImgList=[],t._yjImgList=[],t}return __extends(a,s),a.prototype.reset=function(){this._visibleRect.x=0,this._currentX=0,this._currentY=0,this._roadContainer.x=0;for(var i,e=0,s=this._roadImgList.length,a=0;e<s;)i=this._roadImgList[e],i.x=a,a+=this._roadImgList[e].width,++e;for(this._yjContainer.x=0,e=0,s=this._yjImgList.length,a=t.GameGlobal.stage.stageWidth-this._trackBg.width,this._trackBg.x=a;e<s;)i=this._yjImgList[e],a-=i.width,i.x=a,a+=this._yjImgList[e].width,++e;this._endLine.visible=!1,this._showEndLine=!1},a.prototype.getBitmapData=function(i){return t.Resource.getBitmapData(i)},a.prototype.init=function(){this._yjContainer=new e,this.addChild(this._yjContainer),this._yjContainer.y=96;var s=this._trackBg=new i(this.getBitmapData("TrackBG1_jpg"));this._yjContainer.addChild(s);var a=this.getBitmapData("TrackBG2_jpg");s=new i(a),this._yjContainer.addChild(s),this._yjImgList[0]=s,s=new i(a),this._yjContainer.addChild(s),this._yjImgList[1]=s,this._roadContainer=new e,this.addChild(this._roadContainer),this._roadContainer.y=171,a=this.getBitmapData("Map_png"),s=new i(a),this._roadContainer.addChild(s),this._roadImgList[0]=s,s=new i(a),this._roadContainer.addChild(s),this._roadImgList[1]=s,this._endLine=new e;var n=new i(this.getBitmapData("startLine_png"));n.height=362,n.y=16,this._endLine.addChild(n);var r=new dragonBones.EgretFactory;r.parseDragonBonesData(RES.getRes("carAnim_ske_json")),r.parseTextureAtlasData(RES.getRes("carAnim_tex_json"),RES.getRes("carAnim_tex_png")),r.parseDragonBonesData(RES.getRes("carSkin_ske_json")),r.parseTextureAtlasData(RES.getRes("carSkin_tex_json"),RES.getRes("carSkin_tex_png")),this._flag1=r.buildArmatureDisplay("flag","carAnim"),this._flag1.x=15,this._flag1.y=10,this._flag1.scaleX=this._flag1.scaleY=.6,this._endLine.addChild(this._flag1),this._roadContainer.addChild(this._endLine),this.reset(),t.DataEventDispatcher.addEventListener(t.GameEventType.STATUS_CHANGE,this.statusChange,this)},a.prototype.statusChange=function(i){var e=i.data;e==t.Status.start||(e==t.Status.stop||e==t.Status.over?this._flag1.animation.stop():e==t.Status.finish&&this._flag1.animation.play())},a.prototype.showStartLine=function(){this._startLine.x=this._visibleRect.x+this._half_w+t.TileConst.DIRECTION*this._visibleRect.width;var i=this._startLine.parent.localToGlobal(this._startLine.x,0);return i.x},a.prototype.showEndLine=function(){this._endLine.visible=!0,this._endLine.x=this._visibleRect.x+this._half_w+t.TileConst.DIRECTION*this._visibleRect.width;var i=this._endLine.parent.localToGlobal(this._endLine.x,0);return this._showEndLine=!0,this._flag1.animation.play(),i.x},a.prototype.Resize=function(t,i){this._visibleRect.width=t,this._visibleRect.height=i,this._half_w=t>>1,this._half_h=i>>1,this.moveSceneTo(this._currentX,this._currentY)},a.prototype.setCamera=function(t){this._camera=t},a.prototype.onLoop=function(){var i=t.GameGlobal.status;i!=t.Status.start&&i!=t.Status.free&&i!=t.Status.sprint||this.moveSceneTo(this._camera.x,this._camera.y)},a.prototype.moveSceneTo=function(t,i){if(isNaN(t)||isNaN(i))return!1;if(this._currentX==t&&this._currentY==i)return!1;var e=t-this._currentX;return this._currentX=t,this._visibleRect.x=t,this._roadContainer.x=-this._visibleRect.x,this._yjContainer.x-=.3*e,this.scroll(this._roadImgList,e),this.scroll(this._yjImgList,e),!0},a.prototype.scroll=function(t,i){if(i<0){var e=t[0],s=e.parent.localToGlobal(e.x,e.y);if(s.x>0){var a=t.pop();a.x=e.x-a.width,t.unshift(a)}}else i>0&&(e=t[t.length-1],s=e.parent.localToGlobal(e.x,e.y),s.x>this._visibleRect.width&&(a=t.shift(),a.x=e.x+e.width,t.push(a)))},a}(egret.Sprite);t.Map=s,__reflect(s.prototype,"game.Map")}(game||(game={}));