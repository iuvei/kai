var __reflect=this&&this.__reflect||function(t,e,s){t.__class__=e,s?s.push(e):s=[e],t.__types__=t.__types__?s.concat(t.__types__):s},game;!function(t){var e=function(){function e(){if(this._hasShowEndLine=!1,e._instance)throw new Error("SceneLogic has created!");e._instance=this,this._map=new t.Map,this._scene=new t.GameScene,this._camera=this._scene.camera,this._map.setCamera(this._camera),this._flashEffect=new egret.Shape,this._flashEffect.alpha=0,this._flashEffect.graphics.beginFill(16777215,1),this._flashEffect.graphics.drawRect(0,0,t.GameConst.STAGE_WIDTH,t.GameConst.STAGE_HEIGHT),this._flashEffect.graphics.endFill()}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e)},enumerable:!0,configurable:!0}),e.prototype.initEvent=function(){t.DataEventDispatcher.addEventListener(t.GameEventType.START_GAME,this.onStartGame,this),t.DataEventDispatcher.addEventListener(t.GameEventType.STATUS_CHANGE,this.onGameStatusChange,this)},e.prototype.init=function(e){this._sceneContainer=e,e.addChild(this._map),e.addChild(this._scene);var s=94,a=(t.GameConst.STAGE_HEIGHT+s)/t.GameConst.STAGE_HEIGHT;e.scaleY=a,e.y=-(s>>3)-2,e.scaleX=a,this.initEvent();var n=RES.getRes("gameConfig_json");t.GameConst.SIMULATE_TIME=n.simulateSec,t.GameConst.CAR_GO_DELAY_MS=n.carGoDelayMS,this._showEndLineDelay=n.showEndLineDelay,this._scene.init(n),this._map.init(),this._loopId=t.LoopManager.addToFrame(this.onLoop,this)},e.prototype.resize=function(t,e){this._map.Resize(t,e),this._camera.setViewRange(t,e)},e.prototype.onGameStatusChange=function(e){var s=this,a=t.GameGlobal.status;a==t.Status.photo?(this._sceneContainer.addChild(this._flashEffect),egret.Tween.get(this._flashEffect,{loop:!1}).to({alpha:1},200).wait(100).to({alpha:.1},200).wait(2e3).to({alpha:0},30).call(function(){s._sceneContainer.removeChild(s._flashEffect),t.GameGlobal.status=t.Status.finish,t.LoopManager.setTimeout(function(){t.GameGlobal.status=t.Status.over},s,2e3)})):a==t.Status.rest&&this.reset()},e.prototype.onLoop=function(){var e=this;if(t.GameGlobal.status!=t.Status.photo){if(t.GameGlobal.status==t.Status.sprint){if(!this._hasShowEndLine&&this._rankResult.toString()==t.SceneData.rank.toString()){this._hasShowEndLine=!0;var s=this._map.showEndLine();this._scene.setEndPos(s)}this._hasShowEndLine||this._rankResult.toString()==t.SceneData.rank.toString()&&(this._hasShowEndLine=!0,t.LoopManager.setTimeout(function(){var t=e._map.showEndLine();e._scene.setEndPos(t)},this,this._showEndLineDelay))}this._scene.onLoop(),this._map.onLoop()}},e.prototype.onStartGame=function(e){t.GameGlobal.status=t.Status.start},e.prototype.reset=function(){this._scene.reset(),this._map.reset(),this._hasShowEndLine=!1},e.prototype.setResult=function(t){this._rankResult=t,this._scene.setRank(t)},e}();t.SceneLogic=e,__reflect(e.prototype,"game.SceneLogic")}(game||(game={}));